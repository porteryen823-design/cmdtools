# 資料庫工具程式架構規劃

## 專案概述
建立一個使用 Python + PyQt5 + MySQL 的資料庫查詢工具，提供兩個資料表的可視化界面、篩選功能、資料編輯功能和匯出功能。

## 技術架構
- **前端**: PyQt5 (GUI 框架)
- **後端**: Python
- **資料庫**: MySQL
- **編碼**: UTF-8 (支援中文字元)
- **資料匯出**: JSON 格式

## 資料表結構

### CmdTools 資料表
- iSeqNo (int, 主鍵, 自增)
- cmd (varchar(150))
- example (varchar(150))
- remark1 (varchar(150))
- remark2 (varchar(150))
- Type (varchar(100))

### PromptTools 資料表
- iSeqNo (int, 主鍵, 自增)
- Prompt (text)
- Prompt_Eng (text)
- Classification (varchar(250))

## 資料庫連線配置
```json
{
  "DBServer": "127.0.0.1",
  "DBPort": "3306",
  "DBUser": "root",
  "DBPassword": "gsi5613686#",
  "DataBase": "MyCmdTools"
}
```

## 程式架構設計

### 1. 資料庫連線模組 (database.py)
- MySQL 連線管理
- 資料讀取和快取
- 錯誤處理
- 新增/編輯/刪除操作
- 匯出功能

### 2. GUI 模組 (main_window.py)
- 主視窗佈局
- 使用 QTabWidget 切換兩個資料表
- 全域搜尋控制項
- 編輯對話框
- 匯出對話框

### 3. 表格顯示模組 (table_widget.py)
- 資料表格自訂化
- 篩選邏輯
- 資料更新
- 右鍵選單
- 編輯功能

### 4. 主程式入口 (main.py)
- 應用程式初始化
- 視窗啟動

## UI 設計規劃

### 主視窗佈局（使用分頁 Tab）
```
┌─────────────────────────────────────┐
│        資料庫工具程式                │
├─────────────────────────────────────┤
│全域搜尋: [________] [搜尋] [清除]    │
├─────────────────────────────────────┤
│ [命令工具]     [提示工具]             │
│ ┌─────────────────────────────────┐ │
│ │ [cmd搜尋]    [搜尋] [清除]       │ │
│ │ [example搜]  [搜尋] [清除]       │ │
│ │ [remark1搜]  [搜尋] [清除]       │ │
│ │ [remark2搜]  [搜尋] [清除]       │ │
│ │ [Type搜尋]   [搜尋] [清除]       │ │
│ │                                 │ │
│ │ ┌─────────────────────────────┐ │ │
│ │ │        表格顯示區域          │ │ │
│ │ │                             │ │ │
│ │ │                             │ │ │
│ │ └─────────────────────────────┘ │ │
│ │ [新增] [編輯] [刪除] [匯出]      │ │
│ │ [刷新資料] [更新資料庫]          │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### 詳細功能規劃

#### 1. 資料載入策略
- 程式啟動時連線資料庫
- 載入所有資料到記憶體
- 後續篩選在本地進行
- 支援資料更新功能

#### 2. 篩選功能
- **單一欄位篩選**: 每個資料表的每個欄位都有對應的搜尋框
- **全域搜尋**: 一個搜尋框搜尋兩個資料表的所有欄位
- 即時篩選，無需點擊按鈕
- 支援模糊搜尋
- 搜尋按鈕提供手動觸發
- 清除搜尋按鈕

#### 3. 表格顯示
- 固定欄位順序
- 自動調整欄寬
- 支援垂直滾動
- 資料行數顯示
- 分頁切換
- 單選模式
- 右鍵選單功能

#### 4. 資料編輯功能
- **新增資料**:
  - 點擊新增按鈕或右鍵選單
  - 彈出編輯對話框
  - 輸入所有欄位資料
  - 驗證後寫入資料庫
  - 更新本地快取

- **編輯資料**:
  - 雙擊表格項目或點擊編輯按鈕
  - 彈出編輯對話框（預填現有資料）
  - 修改資料後寫入資料庫
  - 更新本地快取

- **刪除資料**:
  - 選擇資料列
  - 點擊刪除按鈕或右鍵選單
  - 確認刪除對話框
  - 從資料庫刪除
  - 從本地快取移除

#### 5. 匯出功能
- **JSON 格式匯出**:
  - 匯出當前篩選結果
  - 匯出所有資料
  - 選擇匯出檔案路徑
  - 格式化輸出 JSON
  - 包含資料表結構資訊

- **匯出對話框**:
  - 選擇匯出範圍（篩選結果/全部）
  - 選擇匯出格式（JSON）
  - 選擇儲存位置

## 檔案結構
```
cmdtools_gui/
├── __init__.py
├── main.py
├── database.py
├── main_window.py
├── table_widget.py
├── dialogs.py (新增編輯對話框)
├── config.json
└── requirements.txt
```

## 依賴套件
- PyQt5
- mysql-connector-python
- json (內建模組)
- threading (內建模組)

## 分頁設計細節

### Tab 1: 命令工具 (CmdTools)
- 標籤：命令工具
- 欄位：序號、命令、範例、備註1、備註2、類型
- 篩選控制項：每個欄位對應搜尋框和清除按鈕
- 操作按鈕：新增、編輯、刪除、匯出、刷新

### Tab 2: 提示工具 (PromptTools)
- 標籤：提示工具
- 欄位：序號、提示、提示英文、分類
- 篩選控制項：每個欄位對應搜尋框和清除按鈕
- 操作按鈕：新增、編輯、刪除、匯出、刷新

### 全域控制
- 頂部：全域搜尋框、搜尋按鈕、清除按鈕
- 影響兩個資料表

## 編輯對話框設計

### 新增/編輯對話框
```
┌─────────────────────────────┐
│      新增命令工具            │
├─────────────────────────────┤
│序號: [自動生成]              │
│命令: [_______________]      │
│範例: [_______________]      │
│備註1: [_____________]       │
│備註2: [_____________]       │
│類型: [_______________]      │
├─────────────────────────────┤
│        [確定] [取消]        │
└─────────────────────────────┘
```

## 匯出功能設計

### 匯出對話框
```
┌─────────────────────────────┐
│      匯出資料                │
├─────────────────────────────┤
│匯出範圍:                     │
│○ 目前篩選結果               │
│○ 全部資料                   │
├─────────────────────────────┤
│檔案名稱: [export_data.json] │
│目錄:   [C:/Users/...] [瀏覽] │
├─────────────────────────────┤
│        [匯出] [取消]        │
└─────────────────────────────┘
```

### JSON 輸出格式
```json
{
  "export_time": "2025-11-06T07:24:00.000Z",
  "table_name": "CmdTools",
  "total_records": 10,
  "filtered_records": 5,
  "data": [
    {
      "iSeqNo": 1,
      "cmd": "example command",
      "example": "example usage",
      "remark1": "note 1",
      "remark2": "note 2",
      "Type": "command type"
    }
  ]
}
```

## 錯誤處理機制
- 資料庫連線失敗提示
- 資料驗證錯誤
- 檔案匯出錯誤
- 操作確認對話框